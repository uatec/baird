<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:c="using:Baird.Controls"
             xmlns:vm="using:Baird.ViewModels"
             xmlns:conv="using:Baird.Converters"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:CompileBindings="True"
             x:Class="Baird.Controls.VideoLayerControl"
             x:DataType="vm:MainViewModel">
    
    <UserControl.Resources>
        <conv:StringVisibilityConverter x:Key="StringVisibilityConverter"/>
    </UserControl.Resources>
    
    <Grid>
        <!-- Layer 0: Video Player -->
        <c:VideoPlayer Name="Player" 
                       HorizontalAlignment="Stretch" 
                       VerticalAlignment="Stretch"
                       Source="{Binding ActiveItem.StreamUrl}"
                       IsLive="{Binding ActiveItem.IsLive}"
                       IsSubtitlesEnabled="{Binding IsSubtitlesEnabled}"
                       IsPaused="{Binding IsPaused, Mode=TwoWay}"/>

        <!-- Layer 2: Video HUD (Overlay) -->
        <Border Name="HudLayer" IsVisible="{Binding IsVideoHudVisible}" IsHitTestVisible="False">
             <Grid RowDefinitions="Auto,*,Auto">
                 <Border Grid.Row="0" Background="#AA000000" Padding="10">
                     <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
                            <TextBlock Text="SUB" FontSize="16" FontWeight="Bold" Foreground="#FFFF00" IsVisible="{Binding IsSubtitlesEnabled}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <TextBlock Text="{Binding ActiveItem.ChannelNumber}" FontSize="24" FontWeight="ExtraBold" Foreground="#FFD700" IsVisible="{Binding ActiveItem.ChannelNumber, Converter={StaticResource StringVisibilityConverter}}"/>
                            <TextBlock Text="{Binding ActiveItem.Name}" FontSize="24" FontWeight="Bold" Foreground="White"/>
                        </StackPanel>
                        <TextBlock Text="{Binding #Player.PlayerState}" FontSize="14" Foreground="#AAAAAA" HorizontalAlignment="Center"/>
                     </StackPanel>
                 </Border>
                 <Border Grid.Row="2" Background="#AA000000" Padding="20">
                     <StackPanel>
                         <!-- Live Stream Clock -->
                         <TextBlock Text="{Binding #Player.FormattedTime}" 
                                   Foreground="White" 
                                   FontSize="24" 
                                   HorizontalAlignment="Center"
                                   IsVisible="{Binding ActiveItem.IsLive}"/>

                         <!-- VOD Controls -->
                         <StackPanel IsVisible="{Binding !ActiveItem.IsLive}" Spacing="5">
                             <Grid ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center">
                                 <TextBlock Text="{Binding #Player.FormattedTime}" Foreground="White" FontSize="16" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                 
                                 <ProgressBar Grid.Column="1" 
                                              Minimum="0" 
                                              Maximum="{Binding #Player.DurationSeconds}" 
                                              Value="{Binding #Player.PositionSeconds}"
                                              Height="10"
                                              VerticalAlignment="Center"
                                              Margin="0,0,10,0"/>
                                 
                                 <TextBlock Grid.Column="2" Text="{Binding #Player.TimeRemaining}" Foreground="White" FontSize="16" VerticalAlignment="Center"/>
                             </Grid>
                             
                             <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,5,0,0">
                                 <TextBlock Text="{Binding #Player.FinishingAt}" Foreground="#AAAAAA" FontSize="14"/>
                             </StackPanel>
                         </StackPanel>
                     </StackPanel>
                 </Border>
             </Grid>
        </Border>
    </Grid>
</UserControl>
